# ================================================================================================
# NAUTO CONSOLE BACKEND - ENVIRONMENT CONFIGURATION
# ================================================================================================
# This file contains all environment variables required for the NestJS backend application.
# 
# SETUP INSTRUCTIONS:
# 1. Copy this file to .env (for development) or appropriate environment file
# 2. Update all placeholder values with your actual configuration
# 3. Never commit .env files with real secrets to version control
# 4. Each section is clearly marked with boundaries for easy navigation
# ================================================================================================

# ================================================================================================
# CORE APPLICATION SETTINGS
# ================================================================================================
NODE_ENV=development
PORT=3001
APP_NAME=NestJS Template
API_URL=http://localhost:3001
API_VERSION=v1

# ================================================================================================
# DATABASE CONFIGURATION
# ================================================================================================
# PostgreSQL connection string - Update with your database credentials
DATABASE_URL=postgresql://username:password@localhost:5432/database_name?schema=public

# Database connection pool settings (optimized for high performance)
# Maximum number of connections in the pool (default: 50, tune based on your workload)
# For high-concurrency apps: 50-100, for low traffic: 10-20
DATABASE_CONNECTION_LIMIT=50
# Connection timeout in seconds (how long to wait for a connection from pool)
# Increased from 10s to 30s to handle burst traffic better
DATABASE_POOL_TIMEOUT=30
# Query timeout in milliseconds (max time for a single query)
# Reduced from 30s to 10s for faster failure detection
DATABASE_QUERY_TIMEOUT=10000

# ================================================================================================
# JWT AUTHENTICATION CONFIGURATION
# ================================================================================================
# JWT_SECRET: Must be a strong, random string (minimum 32 characters)
JWT_SECRET=your_jwt_secret_here
# JWT_ALGORITHM: Algorithm for JWT signing (HS256, HS384, HS512, RS256, RS384, RS512)
# HS512 provides maximum security for symmetric key algorithms
JWT_ALGORITHM=HS512
# Token expiration times (use: s, m, h, d for seconds, minutes, hours, days)
JWT_ACCESS_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d

# ================================================================================================
# OTP (ONE-TIME PASSWORD) CONFIGURATION
# ================================================================================================
# OTP_SECRET: Base32 secret for TOTP generation (minimum 32 characters)
OTP_SECRET=your_otp_secret_here
# OTP_EXPIRATION: How long OTP codes are valid (in minutes)
OTP_EXPIRATION=5
# OTP_STEP: Time window for OTP validity (in seconds) - standard is 30
OTP_STEP=30
# OTP_DIGITS: Number of digits in OTP codes (6 or 8)
OTP_DIGITS=6

# ================================================================================================
# SMTP EMAIL CONFIGURATION
# ================================================================================================
# For development, use MailHog (runs on localhost:1025)
# For production, use your SMTP provider settings
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USER=
SMTP_PASSWORD=
SMTP_FROM=noreply@example.com
SMTP_SECURE=false

# ================================================================================================
# FRONTEND INTEGRATION URLS
# ================================================================================================
# Base frontend URL and specific paths for email links
FRONTEND_URL=http://localhost:3000
FRONTEND_LOGIN_PATH=/login
FRONTEND_PASSWORD_RESET_PATH=/reset-password
FRONTEND_EMAIL_VERIFICATION_PATH=/verify-email
FRONTEND_DASHBOARD_PATH=/dashboard

# ================================================================================================
# API DOCUMENTATION (SWAGGER)
# ================================================================================================
# Basic auth credentials for Swagger UI access
SWAGGER_USER=admin
SWAGGER_PASSWORD=admin

# ================================================================================================
# CORS SECURITY CONFIGURATION
# ================================================================================================
# Comma-separated list of allowed origins for CORS
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001

# ================================================================================================
# SECURITY CONFIGURATION
# ================================================================================================
# SESSION_SECRET: Used for session signing (minimum 32 characters)
SESSION_SECRET=your_session_secret_at_least_32_characters_long

# ================================================================================================
# REQUEST SIGNATURE VALIDATION
# ================================================================================================
# Enable/disable request signature validation middleware
# WARNING: This should ALWAYS be true in staging and production environments for security
REQUEST_INTEGRITY_ENABLED=false

# Secrets for request signature validation (minimum 32 characters each)
# These secrets are used to verify request integrity and prevent man-in-the-middle attacks
SERVER_INTEGRITY_SECRET=your_server_integrity_secret_min_32_chars_required_here
BOT_INTEGRITY_SECRET=your_bot_integrity_secret_min_32_chars_required_here

# Signature validation settings
# Maximum allowed time difference between request timestamp and server time (in seconds)
SIGNATURE_TIMESTAMP_SKEW_SECONDS=30

# Enable/disable debug logs for signature validation (true/false)
# Set to false in production to avoid exposing sensitive information in logs
SIGNATURE_VALIDATION_LOGS=false

# Maximum allowed content length in bytes (default: 10MB = 10485760 bytes)
# This limit is enforced before processing the request body to prevent memory exhaustion
# Adjust based on your application needs - smaller values provide better security
REQUEST_MAX_CONTENT_LENGTH=10485760

# ================================================================================================
# FILE STORAGE CONFIGURATION (MinIO/S3)
# ================================================================================================
# Storage driver: 'minio' for development, 's3' for production AWS S3
STORAGE_DRIVER=minio

# MinIO configuration (for development)
MINIO_ENDPOINT=localhost
MINIO_PORT=9000
MINIO_USE_SSL=false
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_REGION=us-east-1
MINIO_BUCKET_NAME=nauto-console-dev

# For production: AWS S3 configuration
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
AWS_S3_BUCKET_NAME=your_bucket_name

# ================================================================================================
# SMS SERVICE CONFIGURATION
# ================================================================================================
# SMS Masivos API for sending SMS notifications
SMS_MASIVOS_API_URL=https://app.smsmasivos.com.mx/sms/send
SMS_MASIVOS_API_KEY=your_sms_api_key

# ================================================================================================
# EMAIL SERVICE CONFIGURATION
# ================================================================================================
# Provider: mailhog (dev), resend (prod), smtp (custom)
EMAIL_PROVIDER=mailhog
SUPPORT_EMAIL=support@yourdomain.com
NO_REPLY_EMAIL=noreply@yourdomain.com

# Email template branding
EMAIL_COMPANY_LOGO_URL=https://riaowrkbfhrhwcwqnamr.supabase.co/storage/v1/object/public/assets//logo%20nauto%20sin%20letras.png
EMAIL_PRIMARY_COLOR=ea337e
EMAIL_SECONDARY_COLOR=9fb2ec

# Resend service configuration (production email provider)
RESEND_API_KEY=your_resend_api_key
RESEND_FROM_EMAIL=noreply@yourdomain.com
RESEND_API_URL=https://api.resend.com/emails

# ================================================================================================
# RATE LIMITING & THROTTLING
# ================================================================================================
# Global throttling settings
THROTTLER_TTL=60
THROTTLER_LIMIT=10

# ================================================================================================
# LOGGING CONFIGURATION
# ================================================================================================
# LOG_LEVEL controls the verbosity and detail level of application logs
# 
# Available levels (from least to most verbose):
# - error:   Only critical errors that may cause application failure
# - warn:    Warnings about potential issues, deprecated features, failed operations
# - info:    General application flow, successful operations, user actions
# - debug:   Detailed information for troubleshooting, variable values, method calls
# - verbose: Extremely detailed logs including internal library operations
#
# Level hierarchy (each level includes all levels above it):
# error < warn < info < debug < verbose
#
# Recommendations by environment:
# - Production:  'error' or 'warn' (minimal logging for performance)
# - Staging:     'info' (balanced logging for monitoring)
# - Development: 'debug' (detailed logs for development)
# - Debugging:   'verbose' (maximum detail for troubleshooting)
#
# Performance impact:
# - Higher levels generate more log entries and may impact performance
# - 'verbose' level can significantly slow down the application
# - Consider log retention and storage costs in production
#
# Security note:
# - Higher log levels may expose sensitive information in logs
# - Review log outputs to ensure no secrets or PII are logged
LOG_LEVEL=info

# PRISMA_LOGS_ENABLED controls whether Prisma database logs are displayed
# 
# When enabled (true):
# - Shows SQL queries executed by Prisma
# - Displays query execution time and parameters
# - Useful for debugging database performance issues
# - Can be verbose and may impact console readability
#
# When disabled (false):
# - Suppresses all Prisma database logs
# - Cleaner console output during development
# - Recommended for production environments
#
# Recommendations:
# - Development: 'false' for cleaner output, 'true' for DB debugging
# - Production: 'false' to reduce log noise and improve performance
# - Debugging: 'true' when investigating database queries or performance
PRISMA_LOGS_ENABLED=false

# ================================================================================================
# INTERNATIONALIZATION (i18n) CONFIGURATION
# ================================================================================================
# Default language/locale for the application
DEFAULT_LOCALE=en
# Fallback locale when requested locale is not available
FALLBACK_LOCALE=en
# Comma-separated list of supported locales/languages
SUPPORTED_LOCALES=en,ar

# ================================================================================================
# BUSINESS LOGIC CONFIGURATION
# ================================================================================================
# These settings control business rules, policies, and feature behavior

# ================================================================================================
# EMAIL VERIFICATION SETTINGS
# ================================================================================================
# Enable/disable email verification requirement for new users
EMAIL_VERIFICATION_ENABLED=true
# How long verification codes remain valid (in minutes)
EMAIL_VERIFICATION_EXPIRY_MINUTES=60

# ================================================================================================
# PASSWORD SECURITY POLICIES
# ================================================================================================
# Bcrypt salt rounds for password hashing (12 is secure default)
PASSWORD_SALT_ROUNDS=12
# Password reset link expiration time (in minutes)
PASSWORD_RESET_EXPIRY_MINUTES=30
# Minimum password length requirement
PASSWORD_MIN_LENGTH=8
# Require special characters in passwords
PASSWORD_REQUIRE_SPECIAL=true

# ================================================================================================
# AUTHENTICATION RATE LIMITING
# ================================================================================================
# Maximum failed login attempts per email before lockout
RATE_LIMIT_EMAIL_ATTEMPTS=3
# Maximum failed login attempts per IP address before lockout
RATE_LIMIT_IP_ATTEMPTS=10
# Duration of lockout period (in minutes)
RATE_LIMIT_LOCKOUT_MINUTES=15

# ================================================================================================
# FILE STORAGE POLICIES (Legacy - now managed by StorageTiers and UserStorageConfig)
# ================================================================================================
# How long file download URLs remain valid (in hours)
FILE_URL_EXPIRY_HOURS=24

# ================================================================================================
# USER STORAGE CONFIGURATION
# ================================================================================================
# Default storage tier level for new users (matches StorageTiers.level)
DEFAULT_STORAGE_TIER_LEVEL=1
# Default allowed file types and mime types configuration (JSON format)
# Format: {"extension": ["mime-type1", "mime-type2"]}
DEFAULT_ALLOWED_FILE_CONFIG={"jpg":["image/jpeg"],"jpeg":["image/jpeg"],"png":["image/png"],"pdf":["application/pdf"],"doc":["application/msword"],"docx":["application/vnd.openxmlformats-officedocument.wordprocessingml.document"],"xls":["application/vnd.ms-excel"],"xlsx":["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],"txt":["text/plain"],"csv":["text/csv","application/csv"]}

# ================================================================================================
# SESSION MANAGEMENT POLICIES
# ================================================================================================
# Maximum concurrent sessions per user (-1 for unlimited)
MAX_ACTIVE_SESSIONS=3
# Session timeout due to inactivity (in minutes, -1 to disable)
SESSION_INACTIVITY_TIMEOUT=120
# Whether user activity extends session expiration
SESSION_EXTEND_ON_ACTIVITY=true

# ================================================================================================
# ADDRESS & LOCATION DEFAULTS
# ================================================================================================
# Default country/state for user registration (null for no default)
DEFAULT_COUNTRY=null
DEFAULT_STATE=null
# Whether full address is required during registration
REQUIRE_FULL_ADDRESS=false

# ================================================================================================
# TWO-FACTOR AUTHENTICATION (2FA)
# ================================================================================================
# Enable/disable OTP (One-Time Password) functionality
OTP_ENABLED=true
# Enable/disable sensitive operations validation (2FA requirement)
SENSITIVE_OPERATIONS_ENABLED=true
# Maximum OTP verification attempts before lockout
OTP_MAX_ATTEMPTS=3
# Length of OTP secrets (32 characters recommended)
OTP_SECRET_LENGTH=32

# ================================================================================================
# END OF CONFIGURATION
# ================================================================================================
